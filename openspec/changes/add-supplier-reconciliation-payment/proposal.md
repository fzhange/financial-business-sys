# Change: 供应商对账付款流程

## Why
业务财务系统需要完整的供应商对账付款功能，实现从采购入库/退货到最终付款的全流程闭环管理。该流程是财务系统的核心模块，涉及供应商对账、应付账款管理、发票管理、请款审批和付款核销等关键环节。

## What Changes
- **ADDED** 采购入库/退货记录管理：记录周期内的采购入库单和采购退货单
- **ADDED** 供应商对账单管理：基于账期内的收货/退货记录生成对账单，支持双方核对确认
- **ADDED** 应付账款管理：对账确认后生成应付账款记录
- **ADDED** 发票管理：关联应付账款的发票录入和校验
- **ADDED** 请款管理：发票关联后发起请款申请，支持财务审核
- **ADDED** 付款单管理：审核通过后生成付款单，完成付款操作
- **ADDED** 核销管理：应付金额与实付金额的核销对账

## Impact
- Affected specs: 
  - `purchase-record` - 采购入库/退货记录
  - `supplier-statement` - 供应商对账单
  - `accounts-payable` - 应付账款（含三单核销）
  - `invoice-management` - 发票管理
  - `payment-request` - 请款管理
  - `payment-order` - 付款单
- Affected code: 
  - `app/api/` - 后端 API 接口
  - `app/` - 前端页面组件
  - `data/` - JSON 数据文件存储

## Business Flow
```
周期内持续交易: PO -> 发货 -> 收货记录/退货记录
        ↓
    周期结束
        ↓
  ┌─────┴─────┐
  ↓           ↓
供应商提供    采购方汇总周期内
对账单        收货记录/退货记录
  └─────┬─────┘
        ↓
双方核对: Statement vs 收货记录/退货记录
        ↓
  ┌─────┴─────┐
发现差异      确认无误
  ↓           ↓
沟通确认差异  采购方确认对账结果
  ↓
谁有问题谁修正:
- 供应商问题 → 供应商修正对账单
- 采购方问题 → 采购方修正收货/退货记录
  ↓
重新核对
  └─────┬─────┘
        ↓
供应商根据确认结果开发票
        ↓
采购方接收发票并做最终校验
        ↓
    安排付款
        ↓
应付与实付核销
```
