## ADDED Requirements

### Requirement: 付款单生成
系统 SHALL 支持基于已审批的请款单生成付款单。

#### Scenario: 创建付款单
- **GIVEN** 请款单状态为"已审批"
- **WHEN** 用户发起付款操作
- **THEN** 系统创建付款单，状态为"待付款"，关联请款单和应付账款

#### Scenario: 填写付款信息
- **GIVEN** 创建付款单时
- **WHEN** 用户填写付款方式、收款账号、收款银行等信息
- **THEN** 系统保存付款单详细信息

### Requirement: 付款执行
系统 SHALL 支持执行付款操作并更新相关状态。

#### Scenario: 执行付款
- **GIVEN** 付款单状态为"待付款"
- **WHEN** 财务人员执行付款操作
- **THEN** 系统将付款单状态更新为"付款中"

#### Scenario: 付款完成
- **GIVEN** 付款单状态为"付款中"
- **WHEN** 确认付款成功（录入交易流水号）
- **THEN** 系统将付款单状态更新为"已完成"，记录完成时间，更新应付账款的已付金额

#### Scenario: 付款失败
- **GIVEN** 付款单状态为"付款中"
- **WHEN** 付款失败
- **THEN** 系统将付款单状态更新为"付款失败"，记录失败原因

### Requirement: 付款更新应付账款
系统 SHALL 在付款完成后自动更新应付账款金额。

#### Scenario: 付款后更新应付账款
- **GIVEN** 付款单状态变更为"已完成"
- **WHEN** 系统处理付款完成
- **THEN** 自动更新关联应付账款的已付金额，重新计算未付金额和状态

#### Scenario: 更新请款单状态
- **GIVEN** 付款完成
- **WHEN** 系统处理付款完成
- **THEN** 关联的请款单状态更新为"已付款"

### Requirement: 付款单列表管理
系统 SHALL 提供付款单列表页面。

#### Scenario: 查看付款单列表
- **GIVEN** 存在多条付款单
- **WHEN** 用户访问付款单列表页面
- **THEN** 系统显示所有付款单，包括付款金额、付款方式、状态等信息

#### Scenario: 按状态筛选付款单
- **GIVEN** 付款单列表页面
- **WHEN** 用户选择状态筛选
- **THEN** 系统显示符合条件的付款单

### Requirement: 付款单数据结构
系统 SHALL 按以下结构存储付款单数据：
- 付款单ID、付款单号
- 关联请款单ID、关联应付账款ID
- 供应商ID、供应商名称
- 付款金额
- 付款方式（银行转账/支票/现金/其他）
- 收款账号、收款银行
- 付款日期
- 状态（待付款/付款中/已完成/付款失败）
- 完成时间、交易流水号
- 备注、创建时间、更新时间

#### Scenario: 付款单状态流转
- **GIVEN** 新建的付款单
- **WHEN** 付款单经历完整流程
- **THEN** 状态依次流转：待付款 -> 付款中 -> 已完成（或付款失败）
